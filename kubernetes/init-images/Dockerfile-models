
# SPDX-FileCopyrightText: (C) 2023 - 2025 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

# --- Builder stage ---
FROM python:3.13-slim@sha256:4c2cf9917bd1cbacc5e9b07320025bdb7cdf2df7b0ceaccb55e9dd7e30987419 AS builder

WORKDIR /root

RUN apt-get update && apt-get install -y --no-install-recommends wget && rm -rf /var/lib/apt/lists/*

COPY model_installer/src/install-omz-models model_installer/requirements-runtime.txt .

RUN pip install --no-cache-dir -r requirements-runtime.txt

ENV MODEL_DIR=/root/models
RUN python install-omz-models --default --precisions FP32

# --- Runtime stage ---
FROM busybox:1.37@sha256:ab33eacc8251e3807b85bb6dba570e4698c3998eca6f0fc2ccb60575a563ea74

WORKDIR /root

COPY --from=builder /root/models /root/models
COPY sample_data /root/sample_data
COPY controller/config/tracker-config.json /root/controller/tracker-config.json

CMD ["/bin/sh"]
