# SPDX-FileCopyrightText: (C) 2025 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

networks:
  scenescape-test:

services:
  mediaserver:
    image: bluenviron/mediamtx:1.14.0
    networks:
      scenescape-test:
        aliases:
          - mediaserver
    #  ports:
    #    - "8554:8554"
    restart: always
    pids_limit: 1000

  queuing-cams:
    image: linuxserver/ffmpeg:version-8.0-cli
    command: -nostdin -re -stream_loop -1 -i /workspace/media/qcam1.ts -re -stream_loop -1 -i /workspace/media/qcam2.ts -map 0:v -c copy -f rtsp -rtsp_transport tcp rtsp://mediaserver:8554/queuing-cam1 -map 1:v -c copy -f rtsp -rtsp_transport tcp rtsp://mediaserver:8554/queuing-cam2
    volumes:
      - vol-sample-data:/workspace/media
    networks:
      scenescape-test:
    depends_on:
      - mediaserver
    restart: always
    pids_limit: 1000

  retail-cams:
    image: linuxserver/ffmpeg:version-8.0-cli
    command: -nostdin -re -stream_loop -1 -i /workspace/media/apriltag-cam1.ts -re -stream_loop -1 -i /workspace/media/apriltag-cam2.ts -map 0:v -c copy -f rtsp -rtsp_transport tcp rtsp://mediaserver:8554/retail-cam1 -map 1:v -c copy -f rtsp -rtsp_transport tcp rtsp://mediaserver:8554/retail-cam2
    volumes:
      - vol-sample-data:/workspace/media
    networks:
      scenescape-test:
    depends_on:
      - mediaserver
    restart: always
    pids_limit: 1000

volumes:
  vol-sample-data:
